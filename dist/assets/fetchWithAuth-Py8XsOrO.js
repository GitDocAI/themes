class a{config=null;listeners=new Set;initialize(t){this.config=t,console.log("[TenantContext] Initialized for tenant:",t.tenantId),this.notifyListeners()}getConfig(){if(!this.config)throw new Error("Tenant context not initialized. Make sure authentication is completed.");return this.config}getTenantId(){return this.getConfig().tenantId}getToken(){return this.getConfig().token}getBackendUrl(){return this.getConfig().backendUrl}updateToken(t){if(!this.config)throw new Error("Cannot update token: tenant context not initialized");this.config={...this.config,token:t},console.log("[TenantContext] Token updated for tenant:",this.config.tenantId),this.notifyListeners()}isInitialized(){return this.config!==null}subscribe(t){return this.listeners.add(t),()=>{this.listeners.delete(t)}}notifyListeners(){this.config&&this.listeners.forEach(t=>t(this.config))}isMultiTenantMode(){return new URLSearchParams(window.location.search).has("tenant")}getTenantIdFromURL(){return new URLSearchParams(window.location.search).get("tenant")}getDocumentIdFromURL(){return new URLSearchParams(window.location.search).get("doc")}clear(){this.config=null,console.log("[TenantContext] Cleared")}}const n=new a;function r(e={}){if(!n.isMultiTenantMode()||!n.isInitialized())return e;const t=n.getConfig();return{Authorization:`Bearer ${t.token}`,"X-Tenant-ID":t.tenantId,...e}}function s(){return n.isMultiTenantMode()&&n.isInitialized()?n.getBackendUrl():"https://dashboard.dev.gitdocs.ai/api/v1/visual-editor/docs"}async function c(e,t={}){const o=r(t.headers),i=await fetch(e,{...t,headers:o});if(i.status===401)throw console.error("[fetchWithAuth] Unauthorized - token may be expired"),window.parent!==window&&window.parent.postMessage({type:"TOKEN_EXPIRED",tenantId:n.isInitialized()?n.getTenantId():null},"*"),new Error("Authentication token expired. Please refresh.");return i}function d(){return n.isMultiTenantMode()}export{c as fetchWithAuth,r as getAuthHeaders,s as getBackendUrl,d as isMultiTenantMode};
