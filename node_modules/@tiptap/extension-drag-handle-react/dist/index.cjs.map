{"version":3,"sources":["../src/index.ts","../src/DragHandle.tsx"],"sourcesContent":["import { DragHandle } from './DragHandle.js'\n\nexport * from './DragHandle.js'\n\nexport default DragHandle\n","import {\n  type DragHandlePluginProps,\n  defaultComputePositionConfig,\n  DragHandlePlugin,\n  dragHandlePluginDefaultKey,\n} from '@tiptap/extension-drag-handle'\nimport type { Node } from '@tiptap/pm/model'\nimport type { Plugin } from '@tiptap/pm/state'\nimport type { Editor } from '@tiptap/react'\nimport { type ReactNode, useEffect, useRef, useState } from 'react'\n\ntype Optional<T, K extends keyof T> = Pick<Partial<T>, K> & Omit<T, K>\n\nexport type DragHandleProps = Omit<Optional<DragHandlePluginProps, 'pluginKey'>, 'element'> & {\n  className?: string\n  onNodeChange?: (data: { node: Node | null; editor: Editor; pos: number }) => void\n  children: ReactNode\n}\n\nexport const DragHandle = (props: DragHandleProps) => {\n  const {\n    className = 'drag-handle',\n    children,\n    editor,\n    pluginKey = dragHandlePluginDefaultKey,\n    onNodeChange,\n    onElementDragStart,\n    onElementDragEnd,\n    computePositionConfig = defaultComputePositionConfig,\n  } = props\n  const [element, setElement] = useState<HTMLDivElement | null>(null)\n  const plugin = useRef<Plugin | null>(null)\n\n  useEffect(() => {\n    let initPlugin: {\n      plugin: Plugin\n      unbind: () => void\n    } | null = null\n\n    if (!element) {\n      return () => {\n        plugin.current = null\n      }\n    }\n\n    if (editor.isDestroyed) {\n      return () => {\n        plugin.current = null\n      }\n    }\n\n    if (!plugin.current) {\n      initPlugin = DragHandlePlugin({\n        editor,\n        element,\n        pluginKey,\n        computePositionConfig: {\n          ...defaultComputePositionConfig,\n          ...computePositionConfig,\n        },\n        onElementDragStart,\n        onElementDragEnd,\n        onNodeChange,\n      })\n      plugin.current = initPlugin.plugin\n\n      editor.registerPlugin(plugin.current)\n    }\n\n    return () => {\n      editor.unregisterPlugin(pluginKey)\n      plugin.current = null\n      if (initPlugin) {\n        initPlugin.unbind()\n        initPlugin = null\n      }\n    }\n  }, [element, editor, onNodeChange, pluginKey, computePositionConfig, onElementDragStart, onElementDragEnd])\n\n  return (\n    <div className={className} style={{ visibility: 'hidden', position: 'absolute' }} ref={setElement}>\n      {children}\n    </div>\n  )\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;ACAA,mCAKO;AAIP,mBAA4D;AAuExD;AA7DG,IAAM,aAAa,CAAC,UAA2B;AACpD,QAAM;AAAA,IACJ,YAAY;AAAA,IACZ;AAAA,IACA;AAAA,IACA,YAAY;AAAA,IACZ;AAAA,IACA;AAAA,IACA;AAAA,IACA,wBAAwB;AAAA,EAC1B,IAAI;AACJ,QAAM,CAAC,SAAS,UAAU,QAAI,uBAAgC,IAAI;AAClE,QAAM,aAAS,qBAAsB,IAAI;AAEzC,8BAAU,MAAM;AACd,QAAI,aAGO;AAEX,QAAI,CAAC,SAAS;AACZ,aAAO,MAAM;AACX,eAAO,UAAU;AAAA,MACnB;AAAA,IACF;AAEA,QAAI,OAAO,aAAa;AACtB,aAAO,MAAM;AACX,eAAO,UAAU;AAAA,MACnB;AAAA,IACF;AAEA,QAAI,CAAC,OAAO,SAAS;AACnB,uBAAa,+CAAiB;AAAA,QAC5B;AAAA,QACA;AAAA,QACA;AAAA,QACA,uBAAuB;AAAA,UACrB,GAAG;AAAA,UACH,GAAG;AAAA,QACL;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,MACF,CAAC;AACD,aAAO,UAAU,WAAW;AAE5B,aAAO,eAAe,OAAO,OAAO;AAAA,IACtC;AAEA,WAAO,MAAM;AACX,aAAO,iBAAiB,SAAS;AACjC,aAAO,UAAU;AACjB,UAAI,YAAY;AACd,mBAAW,OAAO;AAClB,qBAAa;AAAA,MACf;AAAA,IACF;AAAA,EACF,GAAG,CAAC,SAAS,QAAQ,cAAc,WAAW,uBAAuB,oBAAoB,gBAAgB,CAAC;AAE1G,SACE,4CAAC,SAAI,WAAsB,OAAO,EAAE,YAAY,UAAU,UAAU,WAAW,GAAG,KAAK,YACpF,UACH;AAEJ;;;ADhFA,IAAO,gBAAQ;","names":[]}