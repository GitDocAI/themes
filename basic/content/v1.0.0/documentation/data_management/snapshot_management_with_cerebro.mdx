This documentation guides you through managing and restoring snapshots using the Cerebro tool in OpenSearch environments, including moving data between cold and hot storage tiers.

## Introduction to Snapshot Management with Cerebro

Snapshot Archiving is a critical feature for long-term data retention, ensuring data records are kept even after indices are removed according to retention policies. While UTMStack itself does not include Cerebro, this tool is essential for effective snapshot management and restoration, facilitating the movement of data from cold to hot storage.

## Understanding Hot and Cold Storage

Data is categorized into different storage types based on its access frequency and purpose:

*   **Hot Storage**: This tier is for actively accessed data, optimized for real-time operations and swift access.
*   **Cold Storage**: Designed for archived data, this storage type is not regularly accessed but is vital for audits, compliance requirements, or retrospective analysis.

Snapshot archiving ensures that data, even if moved to cold storage, can be restored and made available for analysis when needed.

## Configuring Snapshot Path in Linux

By default, snapshots are saved to `/utmstack/opensearch/backups`. To redirect these snapshots to an alternative drive or a remote location, follow these steps:

1.  **Mount the Remote or Different Drive**:
    Use the `mount` command to link your desired storage location to the default snapshot directory. Replace `REMOTE-SERVER:/remote/path` with your specific server and path details.

    ```bash
    sudo mount -t nfs REMOTE-SERVER:/remote/path /utmstack/opensearch/backups
    ```

2.  **Add to `/etc/fstab` for Persistence**:
    To ensure the mount persists across system reboots, add the mount details to the `/etc/fstab` file.

3.  **Test the Configuration**:
    Verify that the mount is working as expected.

    ```bash
    sudo mount -a
    ```

## Restoring Data Using Cerebro

Cerebro plays a crucial role in restoring data from snapshots, enabling the transition of data from cold to hot storage.

### Enabling OpenSearch Communication for Cerebro

For Cerebro to interact with OpenSearch during the restoration process, you must temporarily open port 9200.

1.  **Open Port 9200**:
    Execute the following command to open the port:

    ```bash
    docker service update --publish-add 9200:9200 utmstack_node1
    ```

2.  **Close Port 9200 After Restoration**:
    Once the data restoration is complete, immediately close port 9200 to mitigate security risks. Leaving the port open exposes your OpenSearch data to potential vulnerabilities.

    ```bash
    docker service update --publish-rm 9200:9200 utmstack_node1
    ```

### Working with Cerebro for Restoration

To use Cerebro for data restoration:

1.  **Installation & Access**:
    *   Install Cerebro using the [official Cerebro installation guide](https://github.com/lmenezes/cerebro).
    *   After installation, access its web interface, typically found at `http://localhost:9000`.

2.  **Restoration Process**:
    *   Link Cerebro with your OpenSearch node to enable seamless data restoration.
    *   Within the Cerebro interface, navigate to the "more" dropdown menu and select "snapshot".
    *   In the snapshot view, choose the desired repository from which to restore the backup.

## Summary

Snapshot archiving is a vital component of data retention strategies, allowing organizations to safeguard data over extended periods by moving it between hot and cold storage. While UTMStack manages index rollovers, Cerebro is an indispensable external tool for managing and restoring these snapshots in OpenSearch environments. This process involves configuring snapshot storage paths, securely opening and closing necessary ports for Cerebro's communication with OpenSearch, and following the Cerebro interface workflow to restore backups from a selected repository.